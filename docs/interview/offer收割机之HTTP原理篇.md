---
title: offer收割机之HTTP原理篇
---

作为一只前端开发 🐶，HTTP 是我们知识地图里面必不可少的一部分，也是面试必问知识点。HTTP2 号称可以让我们的应用更快、更简单、更稳定，它完美解决了 1.1 版本的诸多问题，本文和大家一起聊聊 HTTP2 的改进点。

## HTTP 发展史

- HTTP/0.9 - 单行协议
- HTTP 于 1990 年问世，那时候 HTTP 非常简单：只支持 GET 方法；没有首部；只能获取纯文本。
- HTTP/1.0 - 搭建协议的框架
- 1996 年，HTTP 正式被作为标准公布，版本为 HTTP/1.0。1.0 版本增加了首部、状态码、权限、缓存、长连接（默认短连接）等规范，可以说搭建了协议的基本框架。
- HTTP/1.1 - 进一步完善
- 1997 年，1.1 版本接踵而至。1.1 版本的重大改进在于默认长连接；强制客户端提供 Host 首部；管线化；Cache-Control、ETag 等缓存的相关扩展。

## 目前存在的问题

- 线头阻塞：TCP 连接上只能发送一个请求，前面的请求未完成前，后续的请求都在排队等待。
  多个 TCP 连接
- 虽然 HTTP/1.1 管线化可以支持请求并发，但是浏览器很难实现，chrome、firefox 等都禁用了管线化。所以 1.1 版本请求并发依赖于多个 TCP 连接，建立 TCP 连接成本很高，还会存在慢启动的问题。
- 头部冗余，采用文本格式
- HTTP/1.X 版本是采用文本格式，首部未压缩，而且每一个请求都会带上 cookie、user-agent 等完全相同的首部。
  客户端需要主动请求

## HTTP/2.0

### 二进制分层

HTTP2 性能提升的核心就在于二进制分帧层。HTTP2 是二进制协议，他采用二进制格式传输数据而不是 1.x 的文本格式。

### 多路复用

上面提到 HTTP/1.1 的线头阻塞和多个 TCP 连接的问题，HTTP2 的多路复用完美解决。HTTP2 让所有的通信都在一个 TCP 连接上完成，真正实现了请求的并发。

### 头部压缩

在 1.X 版本中，首部用文本格式传输，通常会给每个传输增加 500-800 字节的开销。现在打开一个网页上百个请求已是常态，而每个请求带的一些首部字段都是相同的，例如 cookie、user-agent 等。HTTP2 为此采用 HPACK 压缩格式来压缩首部。头部压缩需要在浏览器和服务器端之间：

维护一份相同的静态字典，包含常见的头部名称，以及常见的头部名称和值的组合
维护一份相同的动态字典，可以动态的添加内容
通过静态 Huffman 编码对传输的首部字段进行编码

### 服务器端推送

服务器端推送使得服务器可以预测客户端需要的资源，主动推送到客户端。
例如：客户端请求 index.html，服务器端能够额外推送 script.js 和 style.css。
实现原理就是客户端发出页面请求时，服务器端能够分析这个页面所依赖的其他资源，主动推送到客户端的缓存，当客户端收到原始网页的请求时，它需要的资源已经位于缓存。
针对每一个希望发送的资源，服务器会发送一个 PUSH_PROMISE 帧，客户端可以通过发送 RST_STREAM 帧来拒绝推送（当资源已经位于缓存）。这一步的操作先于父响应（index.html），客户端了解到服务器端打算推送哪些资源，就不会再为这些资源创建重复请求。当客户端收到 index.html 的响应时，script.js 和 style.css 已经位于缓存。

## 参考链接

[HTTP/2 简介](https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn#_8)

[HTTP/2 幕后原理](https://developer.ibm.com/alert-zh/)

[HTTP/2 头部压缩技术介绍](https://imququ.com/post/header-compression-in-http2.html)

[使用 Wireshark 调试 HTTP/2 流量](https://imququ.com/post/http2-traffic-in-wireshark.html)

[HTTP/2.0 相比 1.0 有哪些重大改进？](https://www.zhihu.com/question/34074946/answer/75364178)

[HTTP/2 新特性浅析](http://io.upyun.com/2015/05/13/http2/)

[本文参考链接](https://juejin.cn/post/6844903734670000142#heading-4)
